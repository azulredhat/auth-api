    name: Continuous Integration
    
    on: 
      pull_request:
        branches:
          - main
    
    jobs:
      test:
        runs-on: ubuntu-latest
        container: node:latest

        services:
          db:
            image: postgres
            env:
              POSTGRES_USER: developer
              POSTGRES_PASSWORD: supersecretpassword
              POSTGRES_DB: forumapi_test
    
        strategy:
          matrix:
            node-version: [14.x]
    
        steps:
        - uses: actions/checkout@v2
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v2
          with:
            node-version: ${{ matrix.node-version }}
        - name: npm install migrate and test
          run: |
            npm install
            npm run migrate:test up
            npm run test
          env:
            CI: true
            PGHOST_TEST: db
            PGUSER_TEST: developer
            PGDATABASE_TEST: forumapi_test
            PGPASSWORD_TEST: supersecretpassword
            PGPORT_TEST: 5432
            PGHOST: ${{ secrets.PGHOST }}
            PGUSER: ${{ secrets.PGUSER }}
            PGDATABASE: ${{ secrets.PGDATABASE }}
            PGPASSWORD: ${{ secrets.PGPASSWORD }}
            PGPORT: ${{ secrets.PGPORT }}
            ACCESS_TOKEN_KEY: ${{ secrets.ACCESS_TOKEN_KEY }}
            REFRESH_TOKEN_KEY: ${{ secrets.REFRESH_TOKEN_KEY }}
            ACCESS_TOKEN_AGE: ${{ secrets.ACCESS_TOKEN_AGE }}